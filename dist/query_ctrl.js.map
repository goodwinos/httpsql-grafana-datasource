{"version":3,"sources":["../src/query_ctrl.js"],"names":["QueryCtrl","DEFAULT","HttpsqlDatasourceQueryCtrl","$scope","$injector","scope","target","alias","metric","params","param_list","datatype","panel","type","datasource","getAliasList","then","alias_list","sort","map","e","Object","text","value","self","getMetricList","metric_list","indexOf","getMetricParamList","panelCtrl","refresh","templateUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAQA,Y,kBAAAA,S;;;;;;;;;;;;;;;;;;;;;AAEJC,U,GAAU,Y;;yCAEDC,0B;;;AAEZ,wCAAYC,MAAZ,EAAoBC,SAApB,EAA+B;AAAA;;AAAA,yJACxBD,MADwB,EAChBC,SADgB;;AAG9B,WAAKC,KAAL,GAAaF,MAAb;AACA,WAAKG,MAAL,CAAYC,KAAZ,GAAoB,MAAKD,MAAL,CAAYC,KAAZ,IAAqBN,OAAzC;AACA,WAAKK,MAAL,CAAYE,MAAZ,GAAqB,MAAKF,MAAL,CAAYE,MAAZ,IAAsBP,OAA3C;AACA,WAAKK,MAAL,CAAYG,MAAZ,GAAqB,MAAKH,MAAL,CAAYG,MAAZ,IAAsB,EAA3C;AACA,WAAKH,MAAL,CAAYI,UAAZ,GAAyB,MAAKJ,MAAL,IAAe,MAAKA,MAAL,CAAYI,UAA3B,IAAyC,EAAlE;AACA,WAAKJ,MAAL,CAAYK,QAAZ,GAAuB,MAAKC,KAAL,CAAWC,IAAlC;AAR8B;AAS9B;;;;oCAEc;AACd,aAAO,KAAKC,UAAL,CACLC,YADK,GAELC,IAFK,CAEA,UAACC,UAAD;AAAA,cAAgBA,WAAWC,IAAX,GAAkBC,GAAlB,CAAsB,UAACC,CAAD;AAAA,eAAO,IAAIC,MAAJ,CAAW,EAACC,MAAMF,CAAP,EAAUG,OAAOH,CAAjB,EAAX,CAAP;AAAA,QAAtB,CAAhB;AAAA,OAFA,CAAP;AAGA;;;qCAEe;AACf,UAAII,OAAO,IAAX;AACA,aAAO,KAAKV,UAAL,CACLW,aADK,CACS,KAAKnB,MAAL,CAAYC,KADrB,EAELS,IAFK,CAEA,UAAUU,WAAV,EAAuB;AAC5B,WAAIA,YAAYC,OAAZ,CAAoBH,KAAKlB,MAAL,CAAYE,MAAhC,KAA2C,CAAC,CAAhD,EACCgB,KAAKlB,MAAL,CAAYE,MAAZ,GAAqBP,OAArB;;AAED,cAAOyB,YAAYR,IAAZ,GAAmBC,GAAnB,CAAuB,UAACC,CAAD;AAAA,eAAO,IAAIC,MAAJ,CAAW,EAACC,MAAMF,CAAP,EAAUG,OAAOH,CAAjB,EAAX,CAAP;AAAA,QAAvB,CAAP;AACA,OAPK,CAAP;AAQA;;;6CAEwB;AACxB,WAAKd,MAAL,CAAYI,UAAZ,GAAyB,KAAKI,UAAL,CAAgBc,kBAAhB,CAAmC,KAAKtB,MAAL,CAAYE,MAA/C,CAAzB;AACA,WAAKqB,SAAL,CAAeC,OAAf;AACA;;;;KAlC8C9B,S;;;;AAqChDE,8BAA2B6B,WAA3B,GAAyC,4BAAzC","file":"query_ctrl.js","sourcesContent":["import {QueryCtrl} from 'app/plugins/sdk';\n\nvar DEFAULT = '* select *';\n\nexport class HttpsqlDatasourceQueryCtrl extends QueryCtrl {\n\n\tconstructor($scope, $injector) {\n\t\tsuper($scope, $injector);\n\t\n\t\tthis.scope = $scope;\n\t\tthis.target.alias = this.target.alias || DEFAULT;\n\t\tthis.target.metric = this.target.metric || DEFAULT;\n\t\tthis.target.params = this.target.params || {};\n\t\tthis.target.param_list = this.target && this.target.param_list || [];\n\t\tthis.target.datatype = this.panel.type;\n\t}\n\n\tgetAliasList() {\n\t\treturn this.datasource\n\t\t\t.getAliasList()\n\t\t\t.then((alias_list) => alias_list.sort().map((e) => new Object({text: e, value: e})));\n\t}\n\n\tgetMetricList() {\n\t\tvar self = this;\n\t\treturn this.datasource\n\t\t\t.getMetricList(this.target.alias)\n\t\t\t.then(function (metric_list) {\n\t\t\t\tif (metric_list.indexOf(self.target.metric) == -1)\n\t\t\t\t\tself.target.metric = DEFAULT;\n\t\t\t\t\n\t\t\t\treturn metric_list.sort().map((e) => new Object({text: e, value: e}))\n\t\t\t});\n\t}\n\n\tupdateMetricParamList () {\n\t\tthis.target.param_list = this.datasource.getMetricParamList(this.target.metric);\n\t\tthis.panelCtrl.refresh();\n\t}\n}\n\nHttpsqlDatasourceQueryCtrl.templateUrl = 'partials/query.editor.html';"]}